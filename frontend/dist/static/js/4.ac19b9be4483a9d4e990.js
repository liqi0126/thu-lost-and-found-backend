webpackJsonp([4],{"30vf":function(e,t,i){var a=i("Wdy1"),l=i("iANj"),s=i("zyKz");e.exports=function(e,t){var i=(l.Object||{})[e]||Object[e],r={};r[e]=t(i),a(a.S+a.F*s(function(){i(1)}),"Object",r)}},MsB0:function(e,t){},WVKr:function(e,t){},ZhOs:function(e,t,i){i("rZAI"),e.exports=i("iANj").Object.keys},fZjL:function(e,t,i){e.exports={default:i("ZhOs"),__esModule:!0}},obKD:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("mvHQ"),l=i.n(a),s=i("fZjL"),r=i.n(s),n=i("bOdI"),o=i.n(n),p=i("mtWM"),d=i.n(p),c=i("zAap"),m=i("pER6"),_=i("v1iK"),u=i("exit"),f={components:{"change-button":c.a,"rej-button":m.a,"approve-button":_.a,"del-button":u.a},props:{id:Number},data:function(){var e;return e={property_template_list:null,property_type_list:[],template_fields_keys:[],template_fields:[],isAdmin:!0,notEdit:!0,inputVisible:!1,inputValue:"",ruleForm:{coverUrl:"",coverFile:""}},o()(e,"inputVisible",!1),o()(e,"inputValue",""),o()(e,"ruleForm",{coverUrl:"",coverFile:""}),o()(e,"template_images",[]),o()(e,"template_image_visible",!1),o()(e,"template_image_url",""),o()(e,"template_image_change",!1),o()(e,"upload_show",!1),o()(e,"create_field_dialogFormVisible",!1),o()(e,"edit_field_dialogFormVisible",!1),o()(e,"edit_field_id",-1),o()(e,"field_show",[]),o()(e,"edit_field",{name:"",details:""}),o()(e,"create_field",{name:"",details:""}),o()(e,"template_type",0),o()(e,"current_template_name",""),e},created:function(){var e=this;d.a.get("/property-templates/"+this.id+"/",{headers:{Authorization:"Bearer "+this.$store.getters.getUserAccessToken}}).then(function(t){e.property_template_list=t.data,e.imgUrlToFile(e.property_template_list.thumbnail),console.log(e.ruleForm),e.template_images.push({url:e.property_template_list.thumbnail}),0!=e.template_images.length&&(e.upload_show=!0),e.template_fields_keys=r()(e.property_template_list.fields);for(var i=0;i<e.template_fields_keys.length;i++){var a={};a.name=e.template_fields_keys[i],a.details=e.property_template_list.fields[e.template_fields_keys[i]],e.template_fields.push(a)}}).catch(function(e){alert("error:"+e)}),d.a.get("/property-types/",{}).then(function(t){e.property_type_list=t.data;for(var i=0;i<e.property_type_list.results.length;i++)e.property_template_list.type==e.property_type_list.results[i].id&&(e.template_type=i);e.current_template_name=e.property_type_list.results[e.template_type].name}).catch(function(e){alert("error:"+e)})},methods:{createField:function(){var e=JSON.parse(l()(this.create_field));this.template_fields.push(e),this.create_field.name="",this.create_field.details="",this.create_field_dialogFormVisible=!1},editField:function(){var e=JSON.parse(l()(this.edit_field));this.$set(this.template_fields,this.edit_field_id,e),this.edit_field.name="",this.edit_field.details="",this.edit_field_dialogFormVisible=!1},handleFieldEdit:function(e,t){this.edit_field_dialogFormVisible=!0,this.edit_field_id=e},handleFieldCreate:function(e,t){this.create_field_dialogFormVisible=!0},handleFieldDelete:function(e,t){this.template_fields.splice(e,1)},DeleteTemplateConfirm:function(){var e=this;return this.$confirm("此操作将删除该模板, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){e.DeleteTemplate()}).catch(function(){e.$message({type:"info",message:"已取消删除"})}),!1},DeleteTemplate:function(){var e=this;d.a.delete("/property-templates/"+this.id+"/",{headers:{Authorization:"Bearer "+this.$store.getters.getUserAccessToken}}).then(function(t){e.$router.push("/property-types-list")}).catch(function(e){alert("error:"+e)}),this.$message({type:"success",message:"删除成功!"})},imgUrlToFile:function(e){var t=this,i=e,a=new Image;a.crossOrigin="*",a.onload=function(){var e=t.getBase64Image(a),i=t.base64toBlob(e),l=t.getFileName(t.ruleForm.coverUrl);t.ruleForm.coverFile=t.blobToFile(i,l)},a.src=i},getBase64Image:function(e){var t=document.createElement("canvas");t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height);var i=e.src.substring(e.src.lastIndexOf(".")+1).toLowerCase();return t.toDataURL("image/"+i)},base64toBlob:function(e){for(var t=e.split(","),i=t[0].match(/:(.*?);/)[1],a=atob(t[1]),l=a.length,s=new Uint8Array(l);l--;)s[l]=a.charCodeAt(l);return new Blob([s],{type:i})},blobToFile:function(e,t){return e.lastModifiedDate=new Date,e.name=t,e},getFileName:function(e){var t=e.lastIndexOf("/");return e.substring(t+1)},handleClose:function(e){this.template_fields.splice(this.template_fields.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.template_fields.push({name:e}),this.inputVisible=!1,this.inputValue=""},handleTemplateImagePreview:function(e){this.template_image_url=e.url,this.template_image_visible=!0},handleTemplateImageRemove:function(e){this.template_images.splice(this.template_images.indexOf({url:e.url}),1),0==this.template_images.length&&(this.upload_show=!1)},saveImage:function(e,t){this.template_images.push({url:e.url}),this.property_template_list.thumbnail=e,this.template_image_change=!0,0!=this.template_images.length&&(this.upload_show=!0)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},change:function(){this.notEdit=!1},confirm:function(){for(var e=this,t={},i=0;i<this.template_fields.length;i++)t[this.template_fields[i].name]=this.template_fields[i].details;if(this.property_template_list.fields=t,console.log(this.template_image_change),0==this.template_image_change)delete this.property_template_list.thumbnail,"NaN"!=parseFloat(this.current_template_name).toString()&&(this.property_template_list.type=this.current_template_name),d.a.put("/property-templates/"+this.id+"/",this.property_template_list,{headers:{Authorization:"Bearer "+this.$store.getters.getUserAccessToken}}).then(function(e){location.reload()}).catch(function(t){e.$alert(t.response.data)});else{var a=new FormData;"NaN"!=parseFloat(this.current_template_name).toString()&&(this.property_template_list.type=this.current_template_name),a.append("name",this.property_template_list.name),a.append("type",this.property_template_list.type),a.append("thumbnail",this.property_template_list.thumbnail.raw),a.append("fields",l()(this.property_template_list.fields)),d.a.put("/property-templates/"+this.id+"/",a,{headers:{Authorization:"Bearer "+this.$store.getters.getUserAccessToken}}).then(function(e){location.reload()}).catch(function(t){e.$alert(t.response.data)})}this.$message("修改成功"),this.notEdit=!0},enterEquipment:function(e){this.$router.push({name:"equipment",params:{equipmentId:e}})},enterUser:function(e){this.$router.push({name:"user",params:{userId:e}})}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"info"},[i("el-card",{staticClass:"title_card",staticStyle:{"font-size":"24px"}},[e._v("\n    "+e._s("物品模板#"+this.id)+"\n    "),i("div",{staticClass:"edit"},[e.isAdmin?i("el-button",{staticClass:"change",attrs:{id:e.id,target:"rent-application",disabled:!e.notEdit,type:"primary"},on:{click:e.change}},[e._v("修改")]):e._e(),e._v(" "),e.isAdmin?i("el-button",{staticClass:"change",attrs:{id:e.id,target:"rent-application",disabled:e.notEdit,type:"primary"},on:{click:e.confirm}},[e._v("确定")]):e._e(),e._v(" "),e.isAdmin?i("el-button",{staticClass:"change",attrs:{id:e.id,target:"user",type:"danger"},on:{click:e.DeleteTemplateConfirm}},[e._v("删除")]):e._e()],1)]),e._v(" "),i("el-dialog",{staticClass:"create_contact",attrs:{title:"添加属性",visible:e.create_field_dialogFormVisible},on:{"update:visible":function(t){e.create_field_dialogFormVisible=t}}},[i("el-form",{attrs:{"label-width":"100px"}},[i("el-form-item",{attrs:{label:"属性名称"}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.create_field.name,callback:function(t){e.$set(e.create_field,"name",t)},expression:"create_field.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"属性权重"}},[i("el-input-number",{attrs:{"controls-position":"right",min:1,max:10,size:"mini",width:"60%"},model:{value:e.create_field.details,callback:function(t){e.$set(e.create_field,"details",t)},expression:"create_field.details"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"foot"},[i("el-button",{on:{click:function(t){e.create_field_dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.createField}},[e._v("确 定")])],1)])],1),e._v(" "),i("el-dialog",{staticClass:"edit_contact",attrs:{title:"修改属性",visible:e.edit_field_dialogFormVisible},on:{"update:visible":function(t){e.edit_field_dialogFormVisible=t}}},[i("el-form",{attrs:{"label-width":"100px"}},[i("el-form-item",{attrs:{label:"属性名称"}},[i("el-input",{attrs:{autocomplete:"off"},model:{value:e.edit_field.name,callback:function(t){e.$set(e.edit_field,"name",t)},expression:"edit_field.name"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"属性名称"}},[i("el-input-number",{attrs:{"controls-position":"right",min:1,max:10,size:"mini",width:"60%"},model:{value:e.edit_field.details,callback:function(t){e.$set(e.edit_field,"details",t)},expression:"edit_field.details"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("div",{staticClass:"foot"},[i("el-button",{on:{click:function(t){e.edit_field_dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:e.editField}},[e._v("确 定")])],1)])],1),e._v(" "),i("el-card",{staticClass:"card"},[i("el-form",{staticClass:"form",attrs:{"label-width":"100px"}},[i("el-divider",[e._v("基本信息")]),e._v(" "),i("el-form-item",{attrs:{label:"ID"}},[i("el-row",[i("el-col",{attrs:{span:5}},[i("el-input",{attrs:{disabled:!0},model:{value:e.property_template_list.id,callback:function(t){e.$set(e.property_template_list,"id",t)},expression:"property_template_list.id"}})],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:"物品名称"}},[i("el-input",{staticStyle:{width:"100%"},attrs:{disabled:e.notEdit},model:{value:e.property_template_list.name,callback:function(t){e.$set(e.property_template_list,"name",t)},expression:"property_template_list.name"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:8}},[i("el-form-item",{staticClass:"label",attrs:{label:"物品种类"}},[i("el-select",{attrs:{disabled:e.notEdit},model:{value:e.current_template_name,callback:function(t){e.current_template_name=t},expression:"current_template_name"}},e._l(e.property_type_list.results,function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1)],1)],1)],1),e._v(" "),i("el-form-item",{staticClass:"label",attrs:{label:"图片"}},[i("div",{staticStyle:{"text-align":"initial","margin-top":"20px"}},[i("el-upload",{class:{is_hidden:e.upload_show},attrs:{action:"none","on-preview":e.handleTemplateImagePreview,"on-remove":e.handleTemplateImageRemove,"auto-upload":!1,limit:1,"on-exceed":e.handleExceed,"list-type":"picture-card","file-list":e.template_images,"on-change":e.saveImage,disabled:e.notEdit}},[i("i",{staticClass:"el-icon-plus"})]),e._v(" "),i("el-dialog",{attrs:{visible:e.template_image_visible},on:{"update:visible":function(t){e.template_image_visible=t}}},[i("img",{attrs:{width:"100%",src:e.template_image_url,alt:""}})])],1)]),e._v(" "),i("el-divider",[e._v("物品属性")]),e._v(" "),i("el-form-item",{staticClass:"label",attrs:{label:"","label-width":"130px"}},[i("el-table",{staticStyle:{width:"80%"},attrs:{data:e.template_fields}},[i("el-table-column",{attrs:{prop:"name",label:"名称",width:"330"}}),e._v(" "),i("el-table-column",{attrs:{prop:"details",label:"权重",width:"330"}}),e._v(" "),i("el-table-column",{scopedSlots:e._u([{key:"header",fn:function(t){return[e._v("\n              操作\n              "),i("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus",circle:"",disabled:e.notEdit},on:{click:function(i){return e.handleFieldCreate(t.$index,t.row)}}})]}},{key:"default",fn:function(t){return[i("el-button",{attrs:{size:"mini",disabled:e.notEdit},on:{click:function(i){return e.handleFieldEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),i("el-button",{attrs:{size:"mini",type:"danger",disabled:e.notEdit},on:{click:function(i){return e.handleFieldDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1)],1)],1)],1)},staticRenderFns:[]};var g={components:{"property-templates-info":i("VU/8")(f,h,!1,function(e){i("MsB0")},"data-v-71768eac",null).exports},data:function(){return{id:parseInt(this.$route.params.templateId)}},created:function(){"true"!=this.$store.getters.getUserLoginStatus&&this.$router.push("/login")}},v={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("property-templates-info",{staticClass:"info",attrs:{id:this.id,height:700}})],1)},staticRenderFns:[]};var b=i("VU/8")(g,v,!1,function(e){i("WVKr")},"data-v-41f6c893",null);t.default=b.exports},rZAI:function(e,t,i){var a=i("wXdB"),l=i("pEGt");i("30vf")("keys",function(){return function(e){return l(a(e))}})}});
//# sourceMappingURL=4.ac19b9be4483a9d4e990.js.map
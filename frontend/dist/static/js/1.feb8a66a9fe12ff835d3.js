webpackJsonp([1],{Quw4:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=s("mtWM"),a=s.n(r),o={name:"Login",data:function(){return{userData:{username:"",pass:"",token:""},has_login:!1}},created:function(){this.$store.commit("setNavIndex",0),"true"==this.$store.getters.getUserLogoutStatus?this.$store.commit("resetState"):"true"==this.$store.getters.getUserLoginStatus&&this.$router.push("/lost-list")},methods:{gotoLogin:function(){this.$router.push({path:"/login"})},submitForm:function(){var t=this,e={email:this.userData.username,password:this.userData.pass};a()({url:"/auth/token/",method:"post",data:e}).then(function(e){t.$store.commit("setUserToken",e.data),t.has_login=!0,t.$store.commit("setUserLoginStatus",!0),t.getCurrentUserData()}).catch(function(e){t.$alert(e.request,"登录失败！"),console.log(e.request)})},getCurrentUserData:function(){var t=this;a()({url:"/users/me/",method:"get",headers:{Authorization:"Bearer "+this.$store.getters.getUserAccessToken}}).then(function(e){console.log(e.data),1==e.data.is_staff?(t.$store.commit("setUserLoginStatus",!0),t.$store.commit("setUserId",e.data.id),t.$store.commit("setUserAvatar",e.data.wechat_avatar),t.$store.commit("setUserIsAdmin",e.data.is_superuser),location.reload()):(t.$alert(error.request,"您不是管理员！"),t.$store.commit("setUserLoginStatus",!1),location.reload())}).catch(function(e){t.$alert(e.request,"登录失败！"),console.log(e.request)})},logout:function(){console.log("logout"),this.$store.commit("resetState"),this.$router.push("/login")},gotoLogon:function(){this.$router.push({path:"/registration"})},gotoAdminLogin:function(){this.$router.push({path:"/adminLogin"})}}},i={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("div",{staticClass:"register-wrapper"},[s("div",{attrs:{id:"register"}},[s("p",{staticClass:"title"},[t._v("登录")]),t._v(" "),s("el-form",{ref:"userData",staticClass:"demo-userData",attrs:{model:t.userData,"label-width":"0"}},[s("el-form-item",{attrs:{prop:"name"}},[s("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:t.userData.username,callback:function(e){t.$set(t.userData,"username",e)},expression:"userData.username"}})],1),t._v(" "),s("el-form-item",{attrs:{prop:"pass"}},[s("el-input",{attrs:{type:"password",placeholder:"输入密码"},model:{value:t.userData.pass,callback:function(e){t.$set(t.userData,"pass",e)},expression:"userData.pass"}})],1),t._v(" "),s("el-form-item",[s("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(e){return t.submitForm(t.userData)}}},[t._v("登录")])],1)],1)],1)])])},staticRenderFns:[]};var n=s("VU/8")(o,i,!1,function(t){s("aCbb")},"data-v-a2bd0ff4",null);e.default=n.exports},aCbb:function(t,e){}});
//# sourceMappingURL=1.feb8a66a9fe12ff835d3.js.map